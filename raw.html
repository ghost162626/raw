<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CodeRaw API</title>
</head>
<body>
<script>
// Obter ID do raw e chave da URL
const urlParams = new URLSearchParams(window.location.search);
const rawId = urlParams.get('id');
const userKey = urlParams.get('key');

if (rawId) {
    // Configuração do Firebase
    const firebaseConfig = {
        apiKey: "sua-api-key",
        authDomain: "seu-projeto.firebaseapp.com",
        databaseURL: "https://seu-projeto.firebaseio.com",
        projectId: "seu-projeto",
        storageBucket: "seu-projeto.appspot.com",
        messagingSenderId: "123456789",
        appId: "seu-app-id"
    };
    
    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    // Buscar raw no Firebase
    const rawsRef = database.ref('raws/' + rawId);
    
    rawsRef.once('value')
        .then((snapshot) => {
            if (snapshot.exists()) {
                const raw = snapshot.val();
                
                // Verificar se é privado e precisa de chave
                if (raw.visibility === 'private') {
                    if (!userKey || userKey !== raw.privateKey) {
                        document.body.textContent = '-- Erro: Chave de acesso inválida ou não fornecida --';
                        return;
                    }
                }
                
                // Mostrar apenas o código puro
                document.body.textContent = raw.code;
                
                // Incrementar visualizações
                database.ref('raws/' + rawId + '/views').transaction((currentViews) => {
                    return (currentViews || 0) + 1;
                });
                
            } else {
                document.body.textContent = '-- Erro: Raw não encontrado --';
            }
        })
        .catch((error) => {
            document.body.textContent = '-- Erro ao carregar código: ' + error.message + ' --';
        });
} else {
    document.body.textContent = '-- Erro: ID do raw não especificado --';
}
</script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</body>
</html>
